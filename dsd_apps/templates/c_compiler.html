<!DOCTYPE html>
<html lang="en">
    <head>
        <meta name="csrf-token" content="{{ csrf_token }}">
        <title>Online C Compiler</title>
    </head>
    <body>
        <h1>Online C Compiler</h1>
        <textarea id="code" rows="10" cols="50" placeholder="Write your C code here..."></textarea><br>
        <button onclick="runCode()">Run</button>
        <pre id="output"></pre>

        <script>
            function runCode() {
                const code = document.getElementById('code').value;

                // Clear previous output before running new code
                document.getElementById('output').textContent = 'Running...';

                // Check if the code contains 'scanf' (indicating input is needed)
                let userInput = null;
                if (code.includes('scanf')) {
                    userInput = prompt("Your code requires input. Please enter the input:");

                    // If user cancels the input prompt
                    if (userInput === null) {
                        document.getElementById('output').textContent = 'No input provided. Execution aborted.';
                        return;
                    }
                }

                // Prepare the payload
                const payload = { code: code };
                if (userInput !== null) {
                    payload.input = userInput;
                }

                // Send the C code and optional input to the backend
                fetch('/c_run_code/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCSRFToken() // For Django CSRF protection
                    },
                    body: JSON.stringify(payload)
                })
                .then(response => response.json())
                .then(data => {
                    // Display the output returned from the backend
                    document.getElementById('output').textContent = data.output;
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('output').textContent = 'Error executing the code.';
                });
            }

            function getCSRFToken() {
                // Access the CSRF token from the meta tag
                return document.querySelector('meta[name="csrf-token"]').getAttribute('content');
            }
        </script>
    </body>
</html>
