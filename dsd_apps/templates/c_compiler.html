<!DOCTYPE html>
<html lang="en">
    <head>
        <meta name="csrf-token" content="{{ csrf_token }}">
        <title>Online C Compiler</title>
    </head>
    <body>
        <h1>Online C Compiler</h1>
        <textarea id="code" rows="10" cols="50" placeholder="Write your C code here..."></textarea><br>
        <button onclick="runCode()">Run</button>
        <pre id="output"></pre>

        <script>
            function runCode() {
                const code = document.getElementById('code').value;
        
                // Clear previous output before running new code
                document.getElementById('output').textContent = 'Running...';
        
                // Detect how many `scanf()` or `fgets()` calls are present in the code
                const inputPatterns = /(scanf|fgets)/g;
                let userInputs = [];
                let match;
        
                // Find all occurrences of `scanf` or `fgets` in the code
                while ((match = inputPatterns.exec(code)) !== null) {
                    // Prompt user for input for each occurrence
                    let userInput = prompt(`Your code requires input for ${match[0]} call. Please enter the input:`);
                    
                    // If user cancels the input prompt
                    if (userInput === null) {
                        document.getElementById('output').textContent = 'Execution aborted due to missing input.';
                        return;
                    }
        
                    userInputs.push(userInput); // Collect each input
                }
        
                // Prepare the payload with the C code and any collected user inputs
                const payload = { 
                    code: code, 
                    inputs: userInputs // Send all inputs together
                };
        
                // Send the C code and user inputs to the backend
                fetch('/c_run_code/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCSRFToken() // For Django CSRF protection
                    },
                    body: JSON.stringify(payload)
                })
                .then(response => response.json())
                .then(data => {
                    // Display the output returned from the backend
                    document.getElementById('output').textContent = data.output;
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('output').textContent = 'Error executing the code.';
                });
            }
        
            function getCSRFToken() {
                // Access the CSRF token from the meta tag
                return document.querySelector('meta[name="csrf-token"]').getAttribute('content');
            }
        </script>        
    </body>
</html>
