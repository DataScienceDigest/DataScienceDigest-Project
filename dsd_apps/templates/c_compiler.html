<!DOCTYPE html>
<html lang="en">
    <head>
        <meta name="csrf-token" content="{{ csrf_token }}">
        <title>Online C Compiler</title>
    </head>
    <body>
        <h1>Online C Compiler</h1>
        <textarea id="code" rows="10" cols="50" placeholder="Write your C code here..."></textarea><br>
        <button onclick="runCode()">Run</button>
        <pre id="output"></pre>

        <script>
            function runCode() {
                const code = document.getElementById('code').value;

                // Check if the code contains scanf (indicating input is needed)
                if (code.includes('scanf')) {
                    // Prompt the user for input if scanf is present
                    const userInput = prompt("Your code requires input. Please enter the input:");

                    // Send the C code and user input to the backend
                    fetch('/c_run_code/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': getCSRFToken() // For Django CSRF protection
                        },
                        body: JSON.stringify({ code: code, input: userInput })
                    })
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById('output').textContent = data.output;
                    })
                    .catch(error => console.error('Error:', error));
                } else {
                    // Send only the C code if no input is needed
                    fetch('/c_run_code/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': getCSRFToken() // For Django CSRF protection
                        },
                        body: JSON.stringify({ code: code })
                    })
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById('output').textContent = data.output;
                    })
                    .catch(error => console.error('Error:', error));
                }
            }

            function getCSRFToken() {
                // Access the CSRF token from the meta tag
                return document.querySelector('meta[name="csrf-token"]').getAttribute('content');
            }
        </script>
    </body>
</html>
